# VeriPix Configuration File - OPTIMIZED FOR 95%+ ACCURACY

# Dataset Configuration
dataset:
  casia_path: "data/raw/casia_v2"
  comofod_path: "data/raw/comofod"
  processed_path: "data/processed"
  masks_path: "data/masks"
  train_split: 0.70
  val_split: 0.15
  test_split: 0.15
  seed: 42

# Image Configuration
image:
  size: [224, 224]
  channels: 3
  normalize_mean: [0.485, 0.456, 0.406]
  normalize_std: [0.229, 0.224, 0.225]

# ELA Configuration
ela:
  quality: 90
  scale: 10  # FIXED - was 255, now matches training

# Model Configuration
classifier:
  architecture: "efficientnet_b0"  # Can upgrade to b4 for +2% accuracy
  pretrained: true
  num_classes: 1
  dropout: 0.4  # Increased from 0.3
  
localizer:
  architecture: "unet"
  encoder_channels: [64, 128, 256, 512]
  decoder_channels: [512, 256, 128, 64]
  output_channels: 1

# Training Configuration
training:
  # CLASSIFIER TRAINING (TARGET: 95%+)
  classifier:
    epochs: 60  # Increased from 50
    batch_size: 16
    learning_rate: 0.0001
    optimizer: "adamw"  # Changed from adam
    weight_decay: 0.0001
    scheduler: "reduce_on_plateau"
    patience: 7  # Increased from 5
    early_stopping: true
    use_advanced_augmentation: true  # NEW!
    gradient_clip: 1.0  # NEW - prevents gradient explosion
    
  # LOCALIZER TRAINING (TARGET: 77%+ IoU)
  localizer:
    epochs: 70  # Increased from 50
    batch_size: 8
    learning_rate: 0.0003  # Reduced from 0.0005
    optimizer: "adamw"  # Changed from adam
    weight_decay: 0.0001
    scheduler: "reduce_on_plateau"
    patience: 10  # Increased from 7
    early_stopping: true
    gradient_clip: 1.0  # NEW

# Loss Configuration - OPTIMIZED
loss:
  # Classifier
  classifier: "focal"  # Changed from "bce"
  focal_alpha: 0.25
  focal_gamma: 2.0
  label_smoothing: 0.1
  
  # Localizer - BEST LOSS FOR HIGH IoU
  localizer: "focal_dice"  # Changed from "dice_bce"
  
  # Focal Dice parameters (OPTIMIZED for 77%+ IoU)
  focal_dice:
    alpha: 0.75        # Weight positive class heavily
    gamma: 2.0         # Focus on hard examples
    dice_weight: 0.6   # Emphasize region overlap
    focal_weight: 0.4  # Moderate focal component
  
  # Alternative: Focal Tversky (if you want precision/recall control)
  focal_tversky:
    alpha: 0.7         # False positive weight
    beta: 0.3          # False negative weight
    gamma: 1.5         # Focusing parameter

# Hardware Configuration
hardware:
  device: "cuda"
  num_workers: 4
  pin_memory: true
  mixed_precision: true

# Checkpoint Configuration
checkpoints:
  save_dir: "checkpoints"
  save_best_only: true
  monitor: "val_f1"  # For classifier
  monitor_localizer: "val_iou"  # For localizer
  mode: "max"

# Logging Configuration
logging:
  tensorboard_dir: "logs"
  log_interval: 10
  
# Evaluation Configuration
evaluation:
  metrics: ["accuracy", "precision", "recall", "f1", "auc_roc", "iou", "dice"]
  confidence_threshold: 0.5
  iou_threshold: 0.5

# GUI Configuration
gui:
  title: "VeriPix - AI-Powered Image Forgery Detector"
  theme: "default"
  port: 7860
  share: false
  max_batch_size: 10

# Ensemble Configuration (for 97%+ accuracy)
ensemble:
  enabled: false
  num_models: 3
  seeds: [42, 123, 999]
  voting: "soft"  # soft or hard

# Test-Time Augmentation (TTA)
tta:
  enabled: false  # Enable for +1-2% accuracy at inference
  num_augmentations: 4
